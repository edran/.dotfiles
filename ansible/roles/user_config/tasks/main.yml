---

- name: Remove Home directories
  file:
    path: "{{ ansible_env.HOME }}/{{ item }}"
    state: absent
  with_items:
    - "Desktop"
    - "Documents"
    - "Downloads"
    - "Music"
    - "Pictures"
    - "Videos"
    - "examples.desktop"
    - "Public"
    - "Templates"

- name: Create development home directory
  file:
    path: "{{ ansible_env.HOME }}/{{item}}"
    state: directory
    group: "{{ ansible_env.USER }}"
    owner: "{{ ansible_env.USER }}"
    mode: 0755
  with_items:
    - "desktop"
    - "docs"
    - "downloads"
    - "media/music"
    - "media/images"
    - "media/videos"
    - "lab"

- name: Symlink dotfiles
  file:
    src: "{{ ansible_env.HOME }}/.dotfiles/{{ item.dot }}"
    dest: "{{ ansible_env.HOME }}/{{ item.dest }}"
    state: link
    force: yes
  with_items: "{{ linking_paths }}"

- name: Add trim to all SSDs
  command: sed -ie 's/^exec fstrim-all*$/& --no-model-check/g' /etc/cron.weekly/fstrim
  sudo: yes

- name: Add gsettings
  gsetting: user="{{ansible_user_id}}"
            key="{{item.key}}"
            value="{{item.value}}"
  with_items: "{{ gsettings_settings }}"

- name: Check sources.list.d exists
  stat:
    path: /etc/apt/sources.list.d
  register: check_path

- name: Ensure apt sources files are 0644
  file:
    path: /etc/apt/sources.list.d/
    mode: 0644 # 755 is directory
    recurse: yes
  sudo: yes
  when: check_path.stat.exists

- name: Ensure sources.list.d is 0755
  file:
    path: /etc/apt/sources.list.d/
    mode: 0755
    recurse: yes
  sudo: yes
  when: check_path.stat.exists
